app-id: org.gtkx.example
runtime: org.gnome.Platform
runtime-version: "48"
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node22
command: gtkx-example
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri

build-options:
  append-path: /usr/lib/sdk/node22/bin
  env:
    npm_config_nodedir: /usr/lib/sdk/node22
  no-debuginfo: true
  strip: false

modules:
  - name: gtkx-example
    buildsystem: simple
    build-commands:
      - node --experimental-sea-config sea-config.json
      - cp /usr/lib/sdk/node22/bin/node app
      - node vendor/postject.cjs app NODE_SEA_BLOB dist/sea-prep.blob --sentinel-fuse NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2
      - install -Dm755 app /app/bin/gtkx-example
      - install -Dm755 dist/gtkx.node /app/bin/gtkx.node
      - mkdir -p /app/share/gtkx-example
      - if [ -d dist/assets ]; then cp -r dist/assets/* /app/share/gtkx-example/; fi
      - install -Dm644 flatpak/org.gtkx.example.desktop /app/share/applications/org.gtkx.example.desktop
      - install -Dm644 flatpak/org.gtkx.example.metainfo.xml /app/share/metainfo/org.gtkx.example.metainfo.xml
      - install -Dm644 assets/icon.png /app/share/icons/hicolor/256x256/apps/org.gtkx.example.png
    sources:
      - type: dir
        path: ..
        skip:
          - .flatpak-builder
          - build-dir
          - flatpak-repo
          - node_modules
